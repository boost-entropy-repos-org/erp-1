<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml" 
                xmlns:o="http://omnifaces.org/ui" xmlns:of="http://omnifaces.org/functions" xmlns:pe="http://primefaces.org/ui/extensions">

    <!--<ui:define name="title">Dashboard</ui:define>-->

    <ui:define name="head">
        <h:outputScript name="chartjs/chart.js" library="demo" />
        <style type="text/css">
            .layout-dashboard .user-card .user-card-content .user-card-name {
                font-size: 20px;
                color: #ffffff;
                position: relative;
                top: -92px;
                margin-left: 10px;
                font-weight: 700;
                white-space: nowrap; }
            body .ui-panel .ui-panel-titlebar {
                padding: 0.1em 0.1em;
            }
            body .ui-panel .ui-panel-content {
                padding: 0.1em 0.1em;
            }
            body .ui-button.ui-button-icon-only .ui-button-text {
                padding: 0.0em;
            }
            .myclass table {
                table-layout: auto !important;
            }

            .myclass th, .myclass td, .myclass thead th, .myclass tbody td, .myclass tfoot td, .myclass tfoot th {
                width: auto !important;
            }
            .layout-dashboard .user-card .user-card-content img {
                width: 25px;
                height: 25px;
                text-align: right;
                margin: 0px 0 0 2px !important;
            }
            .layout-wrapper .layout-menu-container .layout-menu-logo a img {
                margin-top: 0px;
                height: 60px;
                width: 245px;
            }

            .btn-list {
                float: right; 
                width: 26px  !important;  
                height: 26px  !important; 
                margin: 0px 4px 0 0  !important;
            }

        </style>
        <script type="text/javascript">
            function showNewUser() {
                var x = document.getElementById("showNewUserDivID");
                var z = document.getElementById("showUsersDivID");
                z.style.display = "none";
                x.style.display = "block";
            }
            function showUsers() {
                var x = document.getElementById("showNewUserDivID");
                var z = document.getElementById("showUsersDivID");
                z.style.display = "block";
                x.style.display = "none";
            }
        </script>
    </ui:define>

    <ui:define name="viewname" >
        <li>
            <p:link outcome="/dashboardUsers">#{sessionBean.pageName}</p:link> 
        </li>
    </ui:define>

    <ui:define name="content">
        <p:growl id="growl" showDetail="false" sticky="false" life="4000"  />  
        <div class="layout-dashboard">
            <div class="p-grid">
                <div class="p-col-12 p-lg-6 p-xl-3">
                    <div class="overview-box sales">
                        <i class="overview-icon fa fa-barcode"></i>
                        <span class="overview-title">#{bundle.attendance}</span>
                        <b> <p:spacer width="10" /> #{dbView.attendanceDate}</b>
                        <!-- <i class="overview-arrow fa fa-chevron-circle-up"></i> -->

                        <div class="overview-subinfo">
                            <!--<span style="font-size: 15px; color: #ffffff;">DATE</span>  -->
                            <div style="text-align:left;"> <b>#{bundle.entryTime}: #{dbView.entryTime}</b></div> 
                            <div style="text-align:left;"> <b>#{bundle.exitTime}:  #{dbView.exitTime}</b></div> 
                        </div>
                    </div>
                </div>
                <br/>
                <div class="p-col-12 p-lg-6 p-xl-3">
                    <div class="overview-box views">
                        <i class="overview-icon fa fa-search"></i>
                        <span class="overview-title">#{bundle.reqs}</span>
                        <i class="overview-arrow fa fa-chevron-circle-up"></i>
                        <!--<div class="overview-numbers">
                        #{bundle.openReqs}
                    </div> -->
                        <div class="overview-subinfo">
                            <!--<span style="font-size: 15px; color: #ffffff;">YEAR</span> --> 
                            <div style="text-align:left;"> <b>#{bundle.openReqs}: N/A</b></div> 
                            <div style="text-align:left;"> <b>#{bundle.totalReqs}: N/A</b></div> 
                        </div>
                    </div>
                </div>
                <div class="p-col-12 p-lg-6 p-xl-3">
                    <div class="overview-box users">
                        <i class="overview-icon fa fa-tasks"></i>
                        <span class="overview-title">#{bundle.tasks}</span>
                        <i class="overview-arrow fa fa-chevron-circle-up"></i>
                        <!--<div class="overview-numbers">
                            9522
                        </div>-->
                        <div class="overview-subinfo">
                            <span style="font-size: 15px; color: #ffffff;"></span> 
                            <div style="text-align:left;"> <b>#{bundle.openTask}: N/A</b></div> 
                            <div style="text-align:left;"> <b>#{bundle.closedTask}: N/A</b></div>
                        </div>
                    </div>
                </div>
                <div class="p-col-12 p-lg-6 p-xl-3">
                    <div class="overview-box checkin">
                        <i class="overview-icon fa fa-calendar"></i>
                        <span class="overview-title">#{bundle.calendar}</span>
                        <i class="overview-arrow fa fa-chevron-circle-up"></i>
                        <!--<div class="overview-numbers">
                            4211
                        </div>-->
                        <div class="overview-subinfo">
                            <span style="font-size: 15px; color: #ffffff;"></span> 
                            <div style="text-align:left;"> <b>#{bundle.todayEvents}: N/A</b></div> 
                            <div style="text-align:left;"> <b>#{bundle.weekEvents}: N/A</b></div>
                        </div>
                    </div>
                </div>


                <!--          ΚΡΙΤΗΡΙΑ ΑΝΑΖΗΤΗΣΗ ΠΡΟΣΩΠΙΚΟΥ !!!!!!!!!!!!!!!!!!!!! -->
                <!--<div class="p-col-12 p-lg-8">-->
                <div class="p-col-12 p-xl-6">    
                    <h:form id="searchUserForm">
                        <div class="card card-w-title statistics">
                            <div class="erp-panel-titlebar">
                                Αναζήτηση Χρηστών 
                            </div>
                            <table style="width: 100%">
                                <tr>
                                    <td>
                                        <p:outputLabel style="" for="userComplete" value="Επιλογή Χρήστη:" />
                                    </td>

                                    <td colspan="3">                                        
                                        <p:autoComplete widgetVar="acUser" minQueryLength="2" queryDelay="300" scrollHeight="300" id="userComplete" value="#{dbUsers.searchUser}" completeMethod="#{dbUsers.completeUser}" size="70" required="false"  
                                                        var="user" itemLabel="#{user.username} #{user.surname} #{user.name}" itemValue="#{user}" converter="omnifaces.SelectItemsConverter" forceSelection="true" >  
                                            <o:converter converterId="omnifaces.ListConverter"  list="#{dbUsers.availableUsers}" />
                                            <p:ajax event="itemSelect" listener="#{dbUsers.autocompleteUsernameSelectUser}" update="userComplete viewUserResults"  />  
                                        </p:autoComplete>
                                    </td>
                                </tr>  
                                <tr>
                                    <td>
                                        <p:outputLabel value="#{bundle.surname}:" style="" for="userSurname" />
                                    </td>
                                    <td>                                       
                                        <p:inputText size="16" value="#{dbUsers.surname}" id="userSurname" />
                                    </td>
                                    <td>
                                        <p:outputLabel style="" for="selectCompany" value="#{bundle.company}:" />
                                    </td>
                                    <td>                                        
                                        <p:selectOneMenu   value="#{dbUsers.selectedCompany}" id="selectCompany" converter="omnifaces.SelectItemsConverter" >                                                                                     
                                            <f:selectItem itemLabel="" itemValue=""  />
                                            <f:selectItems value="#{applicationBean.companies}" var="company" itemLabel="#{company.name}" itemValue="#{company}"   />						                                                                                                                                    
                                        </p:selectOneMenu>
                                    </td>
                                </tr>


                                <tr>
                                    <td>
                                        <p:outputLabel style="" for="selectRole" value="#{bundle.role}" />
                                    </td>
                                    <td>                                       
                                        <p:selectOneMenu   value="#{dbUsers.selectedRole}" id="selectRole" converter="omnifaces.SelectItemsConverter" >                                                                                     
                                            <f:selectItem itemLabel="" itemValue=""  />
                                            <f:selectItems value="#{applicationBean.roles}" var="role" itemLabel="#{role.name}" itemValue="#{role}"   />						                                                                                                                                    
                                        </p:selectOneMenu >

                                    </td>
                                    <td>
                                        <p:outputLabel value="#{bundle.active}:" style="" for="userActive" />
                                    </td>
                                    <td>
                                        <p:selectBooleanButton id="userActive" value="#{dbUsers.active}" onLabel="Yes" offLabel="No" 
                                                               onIcon="pi pi-check" offIcon="pi pi-times" style="width:60px" />
                                    </td>
                                </tr>
                                <!--<tr>
                                    <td>
                                        <p:outputLabel style="" for="selectSector" value="#{bundle.sector}:" />    
                                    </td>
                                    <td>                                        
                                        <p:selectOneMenu   value="#{dbUsers.selectedSector}" id="selectSector" converter="omnifaces.SelectItemsConverter" >                                                                                      
                                            <f:selectItem itemLabel="" itemValue=""  />
                                            <f:selectItems value="#{applicationBean.sectors}" var="sector" itemLabel="#{sector.name}" itemValue="#{sector}"   />						                                                                                                                                    
                                        </p:selectOneMenu >

                                    </td>
                                    <td>
                                        <p:outputLabel style="" for="selectDepartment" value="#{bundle.department}:" />  
                                    </td>
                                    <td>                                         
                                        <p:selectOneMenu  value="#{dbUsers.selectedDepartment}" id="selectDepartment" converter="omnifaces.SelectItemsConverter" >                                                                          
                                            <f:selectItem itemLabel="" itemValue=""  />
                                            <f:selectItems value="#{applicationBean.departments}" var="department" itemLabel="#{department.name}" itemValue="#{department}"   />						                                                                                                                                    
                                        </p:selectOneMenu >

                                    </td>
                                </tr> -->


                            </table>

                            <p:commandButton value="#{bundle.search}" action="#{administrationAction.fetchUsers}" update="searchUserForm viewUserResults"  />  
                            <p:spacer width="10" />
                            <p:commandButton  value="#{bundle.reset}" action="#{dbUsers.resetSearchUsersForm}"  ajax="false" />
                            <p:spacer width="10" />                            
                        </div>
                        <p:linkButton outcome="insertUser" value="#{bundle.insertUser}" />
                    </h:form>
                </div>








                <!--              ΠΡΟΒΟΛΗ ΠΡΟΣΩΠΙΚΟΥ    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
                <div class="p-col-12 p-xl-6"> 
                    <div class="card user-card">
                        <div id="showUsersDivID" style="display: block" class="user-card-content">
                            <div class="erp-panel-titlebar">
                                Λιστα Χρηστων
                            </div>
                            <h:form id="viewUserResults" >
                                <p:dataTable id="tbl" var="user" value="#{dbUsers.searchUsers}" styleClass="myclass"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                                             paginator="true" rows="20" style="margin-bottom:10px;font-size: 12px;    padding: 0.1em 0.2em ;  ">

                                    <f:facet name="{Exporters}">
                                        <div style="float:right;">


                                            <p:commandLink id="pdf" ajax="false">
                                                <p:graphicImage name="images/pdf.png" library="babylon-layout" />
                                                <f:setPropertyActionListener value="false" target="#{exporterController.customExporter}" />
                                                <pe:exporter type="pdf" target="tbl" fileName="exportData" tableTitle="Λίστα Χρηστών" orientation="Landscape"
                                                             facetBackground="#F88017" facetFontSize="10" facetFontColor="#0000ff"
                                                             cellFontSize="9" cellFontStyle="NORMAL"  fontName="verdana.ttf" encoding="Identity-H" />
                                            </p:commandLink>
                                            <p:commandLink id="xlsx" ajax="false">
                                                <p:graphicImage name="images/xlsx.png"  library="babylon-layout" />
                                                <f:setPropertyActionListener value="false" target="#{exporterController.customExporter}" />
                                                <pe:exporter type="xlsx" target="tbl" fileName="exportData" tableTitle=" Λίστα Χρηστών"
                                                             facetBackground="#F88017" facetFontSize="10" facetFontColor="#0000ff" facetFontStyle="BOLD" 
                                                             cellFontSize="9" cellFontStyle="NORMAL" fontName="verdana.ttf" encoding="Identity-H" />
                                            </p:commandLink>
                                        </div>

                                    </f:facet>

                                    <p:column sortBy="#{user.username}" >
                                        <f:facet name="header">
                                            <h:outputText value="#{bundle.username}" />
                                        </f:facet>
                                        <h:outputText value="#{user.username}" />
                                    </p:column>

                                    <p:column sortBy="#{user.surname}">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundle.surname}"/>
                                        </f:facet>
                                        <h:outputText value="#{user.surname} #{user.name}" />
                                    </p:column>

                                    <p:column exportable="false">
                                        <f:facet name="header" >
                                            <h:outputText value="#{bundle.role}"/>
                                        </f:facet>
                                        <ui:repeat var="userrole" value="#{user.userroles}">
                                            <h:outputText value="#{userrole.role.name}" /> <br/>
                                        </ui:repeat>
                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="#{bundle.company}" />
                                        </f:facet>
                                        <h:outputText value="#{user.company.abbrev}" />
                                    </p:column>

                                    <p:column headerText="#{bundle.actions}" >
                                        <p:commandButton id="bt1" icon="pi pi-search"  title="#{bundle.view}"  onclick="viewUserWidget.show()" class="btn-list" >
                                            <f:setPropertyActionListener value="#{user}" target="#{updateUser.user}" />
                                        </p:commandButton>
                                        <p:commandButton  icon="pi pi-pencil" action="#{administrationAction.goUpdateUser(user.userid)}"  class="btn-list" title="#{bundle.updateUser}"  /> 
                                        <!-- <p:linkButton icon="pi pi-pencil" outcome="updateUser?userID=#{user.userid}"  class="btn-list" /> -->

                                        <p:commandButton  icon="pi pi-trash" action="#{administrationAction.goResetPasword()}"  class="btn-list" update="" title="#{bundle.resetPassword}">
                                            <f:setPropertyActionListener value="#{user}" target="#{updateUser.user}" />                                
                                        </p:commandButton>
                                    </p:column>  

                                    <!--<p:column sortBy="#{user.department.name}">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundle.department}" />
                                        </f:facet>
                                        <h:outputText value="#{user.department.name}" />
                                    </p:column> -->
                                </p:dataTable>
                            </h:form>
                        </div>
                    </div>
                </div>                                        
            </div> 
        </div>


        <p:dialog header="#{bundle.resetPassword}" id="resetPasswordDialogID" position="center" widgetVar="resetPasswordDialogWidget" modal="true" resizable="false" >
            <h:form id="resetPasswordFormID">
                <p:panel id="resetPasswordPanelID" widgetVar="resetPassowrdPanelWidget">
                    <p:messages showDetail="false" closable="true">
                        <p:autoUpdate />
                    </p:messages>
                    <table>
                        <tr>
                            <td><p:outputLabel for="upassword" value="#{bundle.password}:" style="font-weight: bold;" /> </td>                                    
                            <td><p:password  match="urepassword" id="upassword" value="#{updateUser.password}" required="true"
                                             requiredMessage="#{bundle.password}:#{bundle.mandatoryField}" >                                                    
                                    <f:validateLength minimum="4" maximum="15" />
                                </p:password>
                                <p:message for="upassword" display="icon"/>  <br/></td>
                        </tr>
                        <tr>                                    
                            <td><p:outputLabel for="urepassword" value="#{bundle.confirm}:" style="font-weight: bold;" /></td>
                            <td><p:password value="#{updateUser.password}" id="urepassword"  
                                            required="true" requiredMessage="#{bundle.reEnterPassword}:#{bundle.mandatoryField}" >
                                    <f:validateLength minimum="4" maximum="15" />      
                                </p:password>
                                <p:message for="urepassword" display="icon"/> </td>
                        </tr>
                    </table>
                </p:panel>
                <p:commandButton action="#{administrationAction.resetPassword()}" value="#{bundle.resetPassword}" update="growl" />
                <p:spacer width="10" />
                <p:commandButton type="button" immediate="true" value="#{bundle.cancel}" onclick="PF('resetPasswordDialogWidget').hide()" />
            </h:form>
        </p:dialog>


    </ui:define>
</ui:composition> 